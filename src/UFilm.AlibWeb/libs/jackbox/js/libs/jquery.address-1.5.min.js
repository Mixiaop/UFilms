(function(c){var M=function(a){a=c.extend(c.Event(a),function(){for(var a={},z=c.address.parameterNames(),d=0,e=z.length;d<e;d++)a[z[d]]=c.address.parameter(z[d]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:z,parameters:a,queryString:c.address.queryString()}}.call(c.address));c(c.address).trigger(a);return a},u=function(a){return Array.prototype.slice.call(a)},A=function(a,b,z){c().bind.apply(c(c.address),Array.prototype.slice.call(arguments)); return c.address},$=function(a,b){c().unbind.apply(c(c.address),Array.prototype.slice.call(arguments));return c.address},B=function(){return v.pushState&&d.state!==j},Q=function(){return("/"+k.pathname.replace(RegExp(d.state),"")+k.search+(I()?"#"+I():"")).replace(P,"/")},I=function(){var a=k.href.indexOf("#");return-1!=a?p(k.href.substr(a+1),h):""},q=function(){return B()?Q():I()},N=function(a){a=a.toString();return(d.strict&&"/"!=a.substr(0,1)?"/":"")+a},p=function(a,b){return d.crawlable&&b?(""!== a?"!":"")+a:a.replace(/^\!/,"")},r=function(a,b){return parseInt(a.css(b),10)},E=function(){if(!t){var a=q();decodeURI(e)!=decodeURI(a)&&(s&&7>w?k.reload():(s&&(!C&&d.history)&&n(J,50),_old=e,e=a,D(h)))}},D=function(a){var b=M(R);a=M(a?S:T);n(aa,10);if(b.isDefaultPrevented()||a.isDefaultPrevented())e=_old,B()?v.popState({},"",d.state.replace(/\/$/,"")+(""===e?"/":e)):(t=l,x?d.history?k.hash="#"+p(e,l):k.replace("#"+p(e,l)):e!=q()&&(d.history?k.hash="#"+p(e,l):k.replace("#"+p(e,l))),s&&!C&&d.history&& n(J,50),x?n(function(){t=h},1):t=h)},aa=function(){if("null"!==d.tracker&&d.tracker!==F){var a=c.isFunction(d.tracker)?d.tracker:f[d.tracker],b=(k.pathname+k.search+(c.address&&!B()?c.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");c.isFunction(a)?a(b):c.isFunction(f.urchinTracker)?f.urchinTracker(b):f.pageTracker!==j&&c.isFunction(f.pageTracker._trackPageview)?f.pageTracker._trackPageview(b):f._gaq!==j&&c.isFunction(f._gaq.push)&&f._gaq.push(["_trackPageview",decodeURI(b)])}},J=function(){var a= "javascript:"+h+";document.open();document.writeln('<html><head><title>"+m.title.replace(/\'/g,"\\'")+"</title><script>var "+y+' = "'+encodeURIComponent(q()).replace(/\'/g,"\\'")+(m.domain!=k.hostname?'";document.domain="'+m.domain:"")+"\";\x3c/script></head></html>');document.close();";7>w?g.src=a:g.contentWindow.location.replace(a)},V=function(){if(G&&-1!=U){var a,b,c=G.substr(U+1).split("&");for(a=0;a<c.length;a++)b=c[a].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(b[0])&&(d[b[0]]= isNaN(b[1])?/^(true|yes)$/i.test(b[1]):0!==parseInt(b[1],10)),/^(state|tracker)$/.test(b[0])&&(d[b[0]]=b[1]);G=F}_old=e;e=q()},X=function(){if(!W){W=l;V();var a=function(){var a,b=c("a"),e=b.size(),f=-1,j=function(){++f!=e&&(a=c(b.get(f)),a.is('[rel*="address:"]')&&a.address('[rel*="address:"]'),n(j,1))};n(j,1);if(d.crawlable){var h=k.pathname.replace(/\/$/,"");-1!=c("body").html().indexOf("_escaped_fragment_")&&c('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var a= c(this).attr("href").replace(/^http:/,"").replace(RegExp(h+"/?$"),"");(""===a||-1!=a.indexOf("_escaped_fragment_"))&&c(this).attr("href","#"+encodeURI(decodeURIComponent(a.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2"))))})}},b=c("body").ajaxComplete(a);a();d.wrap&&(c("body > *").wrapAll('<div style="padding:'+(r(b,"marginTop")+r(b,"paddingTop"))+"px "+(r(b,"marginRight")+r(b,"paddingRight"))+"px "+(r(b,"marginBottom")+r(b,"paddingBottom"))+"px "+(r(b,"marginLeft")+r(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+ y+'" style="height:100%;overflow:auto;position:relative;'+(x&&!window.statusbar.visible?"resize:both;":"")+'" />'),c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),x&&c('<style type="text/css" />').appendTo("head").text("#"+y+"::-webkit-resizer { background-color: #fff; }"));s&&!C&&(a=m.getElementsByTagName("frameset")[0],g=m.createElement((a?"":"i")+"frame"),g.src="javascript:"+h,a?(a.insertAdjacentElement("beforeEnd",g),a[a.cols?"cols":"rows"]+=",0",g.noResize=l,g.frameBorder= g.frameSpacing=0):(g.style.display="none",g.style.width=g.style.height=0,g.tabIndex=-1,m.body.insertAdjacentElement("afterBegin",g)),n(function(){c(g).bind("load",function(){var a=g.contentWindow;_old=e;e=a[y]!==j?a[y]:"";e!=q()&&(D(h),k.hash=p(e,l))});g.contentWindow[y]===j&&J()},50));n(function(){M("init");D(h)},1);B()||(s&&7<w||!s&&C?f.addEventListener?f.addEventListener(H,E,h):f.attachEvent&&f.attachEvent("on"+H,E):ba(E,50));"state"in window.history&&c(window).trigger("popstate")}},j,F=null,y= "jQueryAddress",H="hashchange",R="change",S="internalChange",T="externalChange",l=!0,h=!1,d={autoUpdate:l,crawlable:h,history:l,strict:l,wrap:h},K=navigator.userAgent.toLowerCase(),w=9,s=-1!==K.search("msie"),x=-1!==K.search("webkit"),f;try{f=top.document!==j&&top.document.title!==j?top:window}catch(da){f=window}var m=f.document,v=f.history,k=f.location,ba=setInterval,n=setTimeout,P=/\/{2,9}/g,C="on"+H in f,g,G=c("script:last").attr("src"),U=G?G.indexOf("?"):-1,O=m.title,t=h,W=h,Y=l,L=h,e=q();_old= e;if(s){w=parseFloat(K.substr(K.indexOf("msie")+4));m.documentMode&&m.documentMode!=w&&(w=8!=m.documentMode?7:8);var Z=m.onpropertychange;m.onpropertychange=function(){Z&&Z.call(m);m.title!=O&&-1!=m.title.indexOf("#"+q())&&(m.title=O)}}v.navigationMode&&(v.navigationMode="compatible");if("complete"==document.readyState)var ca=setInterval(function(){c.address&&(X(),clearInterval(ca))},50);else V(),c(X);c(window).bind("popstate",function(){decodeURI(e)!=decodeURI(q())&&(_old=e,e=q(),D(h))}).bind("unload", function(){f.removeEventListener?f.removeEventListener(H,E,h):f.detachEvent&&f.detachEvent("on"+H,E)});c.address={bind:function(a,b,c){return A.apply(this,u(arguments))},unbind:function(a,b){return $.apply(this,u(arguments))},init:function(a,b){return A.apply(this,["init"].concat(u(arguments)))},change:function(a,b){return A.apply(this,[R].concat(u(arguments)))},internalChange:function(a,b){return A.apply(this,[S].concat(u(arguments)))},externalChange:function(a,b){return A.apply(this,[T].concat(u(arguments)))}, baseURL:function(){var a=k.href;-1!=a.indexOf("#")&&(a=a.substr(0,a.indexOf("#")));/\/$/.test(a)&&(a=a.substr(0,a.length-1));return a},autoUpdate:function(a){return a!==j?(d.autoUpdate=a,this):d.autoUpdate},crawlable:function(a){return a!==j?(d.crawlable=a,this):d.crawlable},history:function(a){return a!==j?(d.history=a,this):d.history},state:function(a){if(a!==j){d.state=a;var b=Q();d.state!==j&&(v.pushState?"/#/"==b.substr(0,3)&&k.replace(d.state.replace(/^\/$/,"")+b.substr(2)):"/"!=b&&b.replace(/^\/#/, "")!=I()&&n(function(){k.replace(d.state.replace(/^\/$/,"")+"/#"+b)},1));return this}return d.state},strict:function(a){return a!==j?(d.strict=a,this):d.strict},tracker:function(a){return a!==j?(d.tracker=a,this):d.tracker},wrap:function(a){return a!==j?(d.wrap=a,this):d.wrap},update:function(){L=l;this.value(e);L=h;return this},title:function(a){return a!==j?(n(function(){O=m.title=a;Y&&(g&&g.contentWindow&&g.contentWindow.document)&&(g.contentWindow.document.title=a,Y=h)},50),this):m.title},value:function(a){if(a!== j){a=N(a);"/"==a&&(a="");if(e==a&&!L)return;_old=e;e=a;if(d.autoUpdate||L)if(D(l),B())v[d.history?"pushState":"replaceState"]({},"",d.state.replace(/\/$/,"")+(""===e?"/":e));else t=l,x?d.history?k.hash="#"+p(e,l):k.replace("#"+p(e,l)):e!=q()&&(d.history?k.hash="#"+p(e,l):k.replace("#"+p(e,l))),s&&!C&&d.history&&n(J,50),x?n(function(){t=h},1):t=h;return this}return N(e)},path:function(a){if(a!==j){var b=this.queryString(),c=this.hash();this.value(a+(b?"?"+b:"")+(c?"#"+c:""));return this}return N(e).split("#")[0].split("?")[0]}, pathNames:function(){var a=this.path(),b=a.replace(P,"/").split("/");("/"==a.substr(0,1)||0===a.length)&&b.splice(0,1);"/"==a.substr(a.length-1,1)&&b.splice(b.length-1,1);return b},queryString:function(a){if(a!==j){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}a=e.split("?");return a.slice(1,a.length).join("?").split("#")[0]},parameter:function(a,b,d){var e,f;if(b!==j){var h=this.parameterNames();f=[];b=b===j||b===F?"":b.toString();for(e=0;e<h.length;e++){var k=h[e], g=this.parameter(k);"string"==typeof g&&(g=[g]);k==a&&(g=b===F||""===b?[]:d?g.concat([b]):[b]);for(var l=0;l<g.length;l++)f.push(k+"="+g[l])}-1==c.inArray(a,h)&&(b!==F&&""!==b)&&f.push(a+"="+b);this.queryString(f.join("&"));return this}if(b=this.queryString()){d=[];f=b.split("&");for(e=0;e<f.length;e++)b=f[e].split("="),b[0]==a&&d.push(b.slice(1).join("="));if(0!==d.length)return 1!=d.length?d:d[0]}},parameterNames:function(){var a=this.queryString(),b=[];if(a&&-1!=a.indexOf("="))for(var a=a.split("&"), d=0;d<a.length;d++){var e=a[d].split("=")[0];-1==c.inArray(e,b)&&b.push(e)}return b},hash:function(a){if(a!==j)return this.value(e.split("#")[0]+(a?"#"+a:"")),this;a=e.split("#");return a.slice(1,a.length).join("#")}};c.fn.address=function(a){var b;"string"==typeof a&&(b=a,a=void 0);c(this).attr("address")||c(b?b:this).live("click",function(b){if(b.shiftKey||b.ctrlKey||b.metaKey||2==b.which)return!0;c(this).is("a")&&(b.preventDefault(),b=a?a.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]: void 0!==c.address.state()&&!/^\/?$/.test(c.address.state())?c(this).attr("href").replace(RegExp("^(.*"+c.address.state()+"|\\.)"),""):c(this).attr("href").replace(/^(#\!?|\.)/,""),c.address.value(b))}).live("submit",function(b){c(this).is("form")&&(b.preventDefault(),b=c(this).attr("action"),b=a?a.call(this):(-1!=b.indexOf("?")?b.replace(/&$/,""):b+"?")+c(this).serialize(),c.address.value(b))}).attr("address",!0);return this}})(jQuery);